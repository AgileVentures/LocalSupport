<%= form_tag("/organizations/search", :method => "get") do %>
  <%= label_tag(:q, "Select Category:") %>
  <%= select("category", "id", @category_options, { :include_blank => 'All' },
             { :style => 'margin-bottom: 5px;' }) %>
  <%= submit_tag "Submit", { :class => 'btn btn-info',
                             :style => 'margin-bottom: 5px;' } %>
  <%= text_field_tag(:q, @query_term || '',
                     { :style => 'margin-bottom: 5px; width: 240px;',
                       :placeholder => "optional search name/description" }) %>
<% end %>

<div id="orgs_scroll" style="height:340px;width:100%;border:1px solid #ccc;overflow:scroll;">
  <div class="table table-bordered">
    <table>
      <div id="organizations">
        <% @organizations.each do |organization| %>
          <tr>
            <td>
              <u><%= link_to organization.name, organization %></u><br/>
              <%= smart_truncate(organization.description) %>
            </td>
          </tr>
        <% end %>
      </div>
    </table>
  </div>
</div>
<br/>

<div style="width:50%;float:left">
  <%= link_to_if(current_user.try(:admin?), 'New Organization',
                 new_organization_path){} %>
</div>

<% content_for :map do %>
    <%= gmaps("map_options" => { "auto_adjust" => false,
                                 "auto_zoom" => true,
                                 "center_latitude" => 51.5978,
                                 "center_longitude" => -0.3370,
                                 "zoom" => 12 },
              "markers"     => { "data" => @json },
              "options" => {"custom_infowindow_class" => "yellow" }
        ) %>
<% end %>

<% content_for :scripts do %>
    <script>
        Gmaps.map.infobox = function(boxText) {
            return {
                content: boxText
                ,disableAutoPan: false
                ,maxWidth: 0
                ,pixelOffset: new google.maps.Size(-140, 0)
                ,zIndex: null
                ,boxStyle: {
                    background: "url('http://google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.5/examples/tipbox.gif') no-repeat"
                    ,opacity: 0.75
                    ,width: "280px"
                }
                ,closeBoxMargin: "10px 2px 2px 2px"
                ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
                ,infoBoxClearance: new google.maps.Size(1, 1)
                ,isHidden: false
                ,pane: "floatPane"
                ,enableEventPropagation: false
            }}
    </script>
<% end %>
